@extends('layouts.app')

@section('content')

<div class="content-wrapper completo">
  <!-- Content Header (Page header) -->
  <div class="content-header   titular">
    <div class="container-fluid">
      <div class="row mb-2">
        <div class="col-sm-6">

        </div><!-- /.col -->
        <div class="col-sm-6">
        </div><!-- /.col -->
      </div><!-- /.row -->
    </div><!-- /.container-fluid -->
  </div>
  <!-- /.content-header -->

  <!-- Main content -->
  <section class="content">
    <div class="container-fluid">
      <!-- Small boxes (Stat box) -->
      <div class="row">
        <div class="col-lg-3 col-6">
          <!-- small box -->
          <div class="small-box    targeticas">
            <div class="inner">
              <h3>{{$totalu}}</h3>

              <p>Total de administradores</p>
            </div>
            <div class="icon">
              <i class="ion ion-bag"></i>
            </div>
            <div style="display: flex;">
              <a href="{{ route('users.index')}}" class="small-box-footer stat-info-btn" >Mas informacion<i class="fas fa-arrow-circle-right"></i></a>
              <svg class="stat-chart" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 50">
                <path d="M0,45 L10,40 L20,35 L30,25 L40,30 L50,20 L60,15 L70,10 L80,15 L90,5 L100,10" fill="none" stroke="#fff" stroke-width="2" />
              </svg>
            </div>

          </div>
        </div>
        <!-- ./col -->
        <div class="col-lg-3 col-6">
          <!-- small box -->
          <div class="small-box card-green targeticas">
            <div class="inner">
              <h3>{{$total}}<sup style="font-size: 10px"></sup></h3>
              <p> Habitantes registrados</p>
            </div>
            <div class="icon">
              <i class="ion ion-stats-bars"></i>
            </div>
            <div style="display: flex;">
              <a href="{{ route('habitantes.index') }}" class="small-box-footer stat-info-btn" >Mas informacion <i class="fas fa-arrow-circle-right"></i></a>
              <svg class="stat-chart" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 50">
                <path d="M0,45 L10,40 L20,35 L30,25 L40,30 L50,20 L60,15 L70,10 L80,15 L90,5 L100,10" fill="none" stroke="#fff" stroke-width="2" />
              </svg>
            </div>
          </div>
        </div>
        <!-- ./col -->
        <div class="col-lg-3 col-6">
          <!-- small box -->
          <div class="small-box card-yellow  targeticas">
            <div class="inner">
              <h3>{{$totalf}}</h3>
              <p>Familiares registrados</p>
            </div>
            <div style="display: flex;">
            <a href="{{ route ('familiares.index')}}" class="small-box-footer   stat-info-btn" >Mas informacion<i class="fas fa-arrow-circle-right"></i></a>
              <svg class="stat-chart" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 50">
                <path d="M0,45 L10,40 L20,35 L30,25 L40,30 L50,20 L60,15 L70,10 L80,15 L90,5 L100,10" fill="none" stroke="#fff" stroke-width="2" />
              </svg>
            </div>
          </div>
        </div>
        <!-- ./col -->
        <div class="col-lg-3 col-6">
          <!-- small box -->
          <div class="small-box card-red targeticas ">
            <div class="inner">
              <h3>6</h3>

              <p>Comunas tratadas</p>
            </div>
            <div class="icon">
              <i class="ion ion-pie-graph"></i>
            </div>
            <div style="display: flex;">
            <a href="home" class="small-box-footer stat-info-btn" > Mas informacion <i class="fas fa-arrow-circle-right"></i></a>
              <svg class="stat-chart" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 50">
                <path d="M0,45 L10,40 L20,35 L30,25 L40,30 L50,20 L60,15 L70,10 L80,15 L90,5 L100,10" fill="none" stroke="#fff" stroke-width="2" />
              </svg>
            </div>
          </div>
        </div>
        <!-- ./col -->
      </div>
      <!-- /.row -->
      <div class="vamosave ">
        <!-- Main row -->
        <section class="mapita" style="width: 100%;">
          <div class="row    ">
            <!-- Left col -->
            <section class="col-lg-7 connectedSortable  " style="width: 100%;">
              <!-- Custom tabs (Charts with tabs)-->
              <div class="card   " style="width: 100%;">
                <html lang="es">

                <head>
                  <meta charset="UTF-8">
                  <meta name="viewport" content="width=device-width, initial-scale=1.0">
                  <title>Mapa de Ocaña</title>
                  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
                  <style>
                    #map {
                      height: 600px;
                      width: 100%;
                    }
                  </style>
                </head>

                <body>
                  <h2 style="padding: 5px;">Mapa de Ocaña, Norte de Santander</h2>
                  <div class="row">
                    <div class="borderinput">
                      <div class="form-group label-floating">
                        <select name="comuna" id="comuna">
                          <option value="">Seleccione una comuna</option>
                          <option value="comuna_1">Comuna 1</option>
                          <option value="comuna_2">Comuna 2</option>
                          <option value="comuna_3">Comuna 3</option>
                          <option value="comuna_4">Comuna 4</option>
                          <option value="comuna_5">Comuna 5</option>
                          <option value="comuna_6">Comuna 6</option>
                        </select>
                      </div>
                    </div>
                  </div>
                  <div id="map"></div>



                  <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
                  <script>
                    var map = L.map('map').setView([8.2371, -73.3562], 14);

                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                      attribution: '© OpenStreetMap contributors'
                    }).addTo(map);

                    var comunaLayer = null; // Guardará el polígono actual
                    var contador1 = @json($contador1);
                    var contador2 = @json($contador2);
                    var contador3 = @json($contador3);
                    var contador4 = @json($contador4);
                    var contador5 = @json($contador5);
                    var contador6 = @json($contador6);

                    var contadores = {
                      comuna_1: contador1,
                      comuna_2: contador2,
                      comuna_3: contador3,
                      comuna_4: contador4,
                      comuna_5: contador5,
                      comuna_6: contador6
                    };

                    const comunaCoords = {
                      comuna_1: [
                        [8.232320106113454, -73.35460709651709],
                        [8.232982257565421, -73.35414032016514],
                        [8.233859991504438, -73.35382913593052],
                        [8.233290234607704, -73.35213318185187],
                        [8.233475020718092, -73.35062393831397],
                        [8.235630852348624, -73.35110627385254],
                        [8.23804844955166, -73.35163528704204],
                        [8.239649907112726, -73.35238212920218],
                        [8.241389944940906, -73.35241324762565],
                        [8.244408045541787, -73.35457597806062],
                        [8.247225945251795, -73.35575847818707],
                        [8.249150728531895, -73.35580515582227],
                        [8.24942789655214, -73.35736107699533],
                        [8.248355490221545, -73.35804775138052],
                        [8.244968381059085, -73.35784390349913],
                        [8.243205798649925, -73.35898116005565],
                        [8.239993033755805, -73.35840373194316],
                        [8.237497736044343, -73.35812475615168],
                        [8.236308502246661, -73.3600130312385],
                        [8.235023700954239, -73.35798528122798],
                        [8.235455995119151, -73.35634274137607],
                        [8.235310694325927, -73.35583556314562],
                        [8.234399260861117, -73.35619592662515],
                        [8.233765218952437, -73.35626266060284],
                        [8.233466954565996, -73.35552885559284],
                        [8.232536933940416, -73.35527402025768]
                      ],
                      comuna_2: [
                        [8.233554180473925, -73.35044025583477],
                        [8.23373796107143, -73.34974390078607],
                        [8.234381192490966, -73.34937251142676],
                        [8.234794697851681, -73.34904754573736],
                        [8.235277120226657, -73.34644782022217],
                        [8.23741355510592, -73.34531044030928],
                        [8.239733756266132, -73.34312852782331],
                        [8.240491838844916, -73.34373203553218],
                        [8.24017022823132, -73.34586752434824],
                        [8.240285089194753, -73.3470281160961],
                        [8.242306636648951, -73.3466335149116],
                        [8.242076915872143, -73.3489779101454],
                        [8.246717249743696, -73.35136872904717],
                        [8.24910794090624, -73.34887027729268],
                        [8.251963508967929, -73.34954130801817],
                        [8.252461571050967, -73.34840055578485],
                        [8.250834565921767, -73.34746111276918],
                        [8.24910794090624, -73.34578353595546],
                        [8.248842305618886, -73.34366978917022],
                        [8.250004458682865, -73.34283100076337],
                        [8.249838437025838, -73.34152249084867],
                        [8.250569692638573, -73.34188460748193],
                        [8.25236344962489, -73.34514328831123],
                        [8.2553279650472, -73.34869547340783],
                        [8.258527271644889, -73.35134532410643],
                        [8.257216083551523, -73.35192829126012],
                        [8.257006293052454, -73.35282924049766],
                        [8.25753076909107, -73.35415416584695],
                        [8.259915552232751, -73.35398695832696],
                        [8.259252478029953, -73.35644929691833],
                        [8.25332876523717, -73.35492172912747],
                        [8.252123553155117, -73.35861013569873],
                        [8.249589213227221, -73.35655550296086],
                        [8.246023428242383, -73.35610884350537],
                        [8.243754275611481, -73.35473908833646],
                        [8.241750337843577, -73.35366710603844],
                        [8.240895714236782, -73.35220801902172],
                        [8.239127521602857, -73.3520889098775],
                        [8.238155012188473, -73.35143380955131],
                        [8.237771901801446, -73.35223779627482],
                        [8.236386807308063, -73.35185069155611],
                        [8.235738463539384, -73.35113603669076],
                        [8.234382832228157, -73.35170180512581],
                        [8.23352819271158, -73.35065960011387]

                      ],
                      comuna_3: [
                        [8.233396087498702, -73.35058470061843],
                        [8.233748058316724, -73.34977181709509],
                        [8.23520621980102, -73.3473839717453],
                        [8.235155938459934, -73.34580900991882],
                        [8.23676493820703, -73.34555498381779],
                        [8.23802196470845, -73.34458968463382],
                        [8.238675616911301, -73.34387841155092],
                        [8.239580672025024, -73.34418324287215],
                        [8.239882356602887, -73.34316713846799],
                        [8.23746887353971, -73.34047446179693],
                        [8.234406039029937, -73.34139925623555],
                        [8.232757804496176, -73.34043200753844],
                        [8.228714979816104, -73.33681129997],
                        [8.228714979816104, -73.33472243021896],
                        [8.227107026714162, -73.33319059240154],
                        [8.226693552004729, -73.33323701172932],
                        [8.227061085101075, -73.33421181761315],
                        [8.225919939766767, -73.33467209281562],
                        [8.224516773000476, -73.3347346406381],
                        [8.22379455287573, -73.33677786950562],
                        [8.22272956386839, -73.3377638341701],
                        [8.223821041508941, -73.33892044665636],
                        [8.22491251614444, -73.34039983472016],
                        [8.22533845665035, -73.34201371260794],
                        [8.2251254864546, -73.34365448846052],
                        [8.22549818422206, -73.3444614274044],
                        [8.22648316949187, -73.34481110094676],
                        [8.226864597282624, -73.34606559145789],
                        [8.226293308073496, -73.34732694352185],
                        [8.224389004762447, -73.34880208407122],
                        [8.22430436884738, -73.34925103989059],
                        [8.225637382410428, -73.34860967443434],
                        [8.227012709165377, -73.34871656867705],
                        [8.227097344502093, -73.3508972112283],
                        [8.226102878161239, -73.35194477493798],
                        [8.224981455668972, -73.35183788069526],
                        [8.224346686814302, -73.35247924615152],
                        [8.225362316493857, -73.35260751924275],
                        [8.2266530087898, -73.35316336930484],
                        [8.22591244815036, -73.35451023676296],
                        [8.225214204003146, -73.35457437344911],
                        [8.225573905691697, -73.35666950060619],
                        [8.226807971771823, -73.35757125355994],
                        [8.225045913566062, -73.36045376614368],
                        [8.225381544304456, -73.36325149894553],
                        [8.226262573640518, -73.3638873473096],
                        [8.227374345959868, -73.36346344840021],
                        [8.228024626436753, -73.36234011629038],
                        [8.22825537086557, -73.36032659647087],
                        [8.229258914930117, -73.35941212006367],
                        [8.230509648098472, -73.36049391640988],
                        [8.231677406257376, -73.36047265671976],
                        [8.233160769764712, -73.35815535049817],
                        [8.233907709578657, -73.35680536016936],
                        [8.2336131419367, -73.3560719008607],
                        [8.23286620157654, -73.35638016636723],
                        [8.232077178539868, -73.3545199433757],
                        [8.232876721873826, -73.35414789879886],
                        [8.232119259806641, -73.3518305925463],
                        [8.233297533504887, -73.35064004990035],
                      ],
                      comuna_4: [
                        [8.23386227742074, -73.3568842445085],
                        [8.233119185231143, -73.35811009141365],
                        [8.23195146611585, -73.35948916918196],
                        [8.231769483605953, -73.36053113905133],
                        [8.232771053608134, -73.3615677163265],
                        [8.232398906321766, -73.3629777996042],
                        [8.23253846159513, -73.36314230931993],
                        [8.233189718887262, -73.36243726768107],
                        [8.234771339280488, -73.36304830376812],
                        [8.235981766594103, -73.36281227152173],
                        [8.237394007711774, -73.36330583235065],
                        [8.2375532798658, -73.36304834029336],
                        [8.239103537425155, -73.36341308632196],
                        [8.239666296377163, -73.36405681645161],
                        [8.241513834241262, -73.36355255062864],
                        [8.241789903059646, -73.36333797391423],
                        [8.243987828764562, -73.36375639845782],
                        [8.244380693413692, -73.36337016037189],
                        [8.244943444798702, -73.36260841303573],
                        [8.246153888516208, -73.36361692356665],
                        [8.245962766079248, -73.36488292618165],
                        [8.246780344745154, -73.36441085740996],
                        [8.248245611415166, -73.36443231506715],
                        [8.24927554195133, -73.36333797382366],
                        [8.249997896418304, -73.3602741363807],
                        [8.250901261774963, -73.35851039655037],
                        [8.250181631899729, -73.35787606895362],
                        [8.248466763966167, -73.35821643979806],
                        [8.246323168586114, -73.35796889736574],
                        [8.246386899230266, -73.3585160765292],
                        [8.244794210371259, -73.3587842974222],
                        [8.24445315202266, -73.3600790253041],
                        [8.243040929182518, -73.35849838424703],
                        [8.24153262956978, -73.35805852461304],
                        [8.240056614927312, -73.35888406972475],
                        [8.239058491536126, -73.35822964689407],
                        [8.238920456198052, -73.35918451327319],
                        [8.238124097538053, -73.35826183340124],
                        [8.237157846878816, -73.3580257990154],
                        [8.235989848367824, -73.35859442730484],
                        [8.23581995739686, -73.35791851065444],
                        [8.235618246186558, -73.35640574007093],
                        [8.234057368683393, -73.35677052048543]
                      ],
                      comuna_5: [
                        [8.249366564666717, -73.35718845609732],
                        [8.252184617553041, -73.35877041517075],
                        [8.25293609492802, -73.35617600229033],
                        [8.25287347186804, -73.35551157947948],
                        [8.253374456069904, -73.35497371339453],
                        [8.25715936890186, -73.35570478226859],
                        [8.257515126175726, -73.35424792589818],
                        [8.259947253734872, -73.35395446170071],
                        [8.261564291801372, -73.35299717367063],
                        [8.261953829761088, -73.35239644583102],
                        [8.26177549626461, -73.3516756309861],
                        [8.261374245602822, -73.35034662861575],
                        [8.262377371492228, -73.3489275243898],
                        [8.264651114065888, -73.35090976521336],
                        [8.26367028554332, -73.35304968428424],
                        [8.262176746518369, -73.35235139490321],
                        [8.261730912877885, -73.35300463335643],
                        [8.260482576004806, -73.35343261717061],
                        [8.260103615815583, -73.35395070284041],
                        [8.26099528626983, -73.35435616119068],
                        [8.260794660593287, -73.35606809644739],
                        [8.265230693484797, -73.35685648780007],
                        [8.2680171207491, -73.351472901927],
                        [8.270067918724267, -73.35304968437181],
                        [8.270001045048396, -73.35534728169003],
                        [8.267838790082042, -73.35597799467935],
                        [8.267281505952251, -73.35672133498818],
                        [8.265899437911873, -73.35726194612188],
                        [8.265495931146676, -73.35931111352981],
                        [8.262948181485324, -73.36028118317445],
                        [8.259461748623389, -73.36544532265727],
                        [8.261144243104937, -73.36459525647268],
                        [8.26343429351119, -73.3638396420864],
                        [8.259975844920392, -73.37465437299008],
                        [8.255613886911643, -73.3746528398946],
                        [8.253484850959268, -73.37247209616066],
                        [8.253484850959268, -73.37033952769144],
                        [8.253364252040692, -73.3675976539453],
                        [8.251021295544762, -73.36543793568772],
                        [8.251039498425941, -73.36467398480706],
                        [8.25010915401151, -73.36458126878702],
                        [8.250212524984487, -73.36266631643278],
                        [8.249075442794421, -73.36284040301044],
                        [8.250591551654084, -73.35827933467584],
                        [8.249487339948297, -73.35732443952824]
                      ],
                      comuna_6: [
                        [8.263600667330987, -73.3607382170331],
                        [8.264012839306035, -73.359648563548],
                        [8.265231490891344, -73.35920876340302],
                        [8.266058430894175, -73.35850508317101],
                        [8.266754800078017, -73.35813125304777],
                        [8.26736412210515, -73.35927473342475],
                        [8.26886566173052, -73.35995642366274],
                        [8.270258388952472, -73.3609679639962],
                        [8.270998273353493, -73.36008836369368],
                        [8.271520543812754, -73.36026428375166],
                        [8.271738156299833, -73.36101194399815],
                        [8.274632391009558, -73.36244129450354],
                        [8.277417799768537, -73.36400258501827],
                        [8.277918300817174, -73.36551989551849],
                        [8.279394059768858, -73.36547699056418],
                        [8.27970195311473, -73.364908362271],
                        [8.279893097860354, -73.36491913474279],
                        [8.280062969865657, -73.36498350775712],
                        [8.279818778834994, -73.36765498785151],
                        [8.279297257436616, -73.36771826672374],
                        [8.278033625169844, -73.36829444634732],
                        [8.276552645861765, -73.3679690001401],
                        [8.276326088753514, -73.36814510899875],
                        [8.275972016111018, -73.36807329070957],
                        [8.275994781655147, -73.36828033673774],
                        [8.276393178464428, -73.36838385975183],
                        [8.276654981862542, -73.36834935208046],
                        [8.276871254103662, -73.36822282395214],
                        [8.277019229779148, -73.36830334185198],
                        [8.277019229779148, -73.36845287509455],
                        [8.276324881897168, -73.36867142367983],
                        [8.275334297645854, -73.36955838204896],
                        [8.273840251863582, -73.36897675211029],
                        [8.272885039252474, -73.370969144031],
                        [8.273277827663964, -73.37156992070749],
                        [8.271833888410756, -73.37208490482207],
                        [8.271515371686776, -73.37236385455081],
                        [8.269795397017418, -73.37205276967123],
                        [8.269954656106552, -73.37043271547743],
                        [8.268726421708251, -73.37047277255314],
                        [8.266496686444036, -73.37002807155632],
                        [8.265880573161006, -73.37115464741494],
                        [8.26400288864804, -73.3712435876143],
                        [8.26356280504739, -73.37228122327355],
                        [8.265890382827951, -73.374595083834],
                        [8.265745575252094, -73.37639979169927],
                        [8.265359421456575, -73.37693632647003],
                        [8.264804324713154, -73.37671683497291],
                        [8.26451470871083, -73.37496090299587],
                        [8.262270177483515, -73.37439998028097],
                        [8.261932289956388, -73.37118077165641],
                        [8.260363522647593, -73.37013209005902],
                        [8.258906701163784, -73.37126569488724],
                        [8.257834337939691, -73.3707954535113],
                        [8.259129266750895, -73.36922116716579],
                        [8.260010548435979, -73.36838435672112],
                        [8.260053018586246, -73.36751532102777],
                        [8.26042463220615, -73.36657118348435],
                        [8.26114855802363, -73.36610870721174],
                        [8.262044030568322, -73.36574979557305],
                        [8.26292329487967, -73.36388397349322],
                        [8.263362926300529, -73.36375070048751],
                        [8.262778282653947, -73.36246913340766],
                        [8.263534138155865, -73.36075061762637]
                      ]

                    };


                    document.getElementById("comuna").addEventListener("change", function() {
                      var seleccion = this.value;

                      if (comunaLayer) {
                        map.removeLayer(comunaLayer);
                      }
                      if (comunaCoords[seleccion]) {
                        comunaLayer = L.polygon(comunaCoords[seleccion], {
                          color: "blue",
                          fillColor: "#3388ff",
                          fillOpacity: 0.4
                        }).addTo(map);

                        comunaLayer.bindPopup("<b>" + seleccion.replace('_', ' ').toUpperCase() + "</b><br> Cuenta con un total de " + (contadores[seleccion] || 0) + " habitantes de calle");
                        map.fitBounds(comunaLayer.getBounds());
                      }
                    });
                  </script>
                </body>

                </html>
                <!-- /.card-body -->
              </div>
            </section>
        </section> <!-- right col -->
      </div>
      <!-- /.card -->
      <div class="row  ">
        <section class="grafica">
          <section class="col-lg connectedSortable ">
            <!-- Custom tabs (Charts with tabs)-->
            <div class="card">
              <!-- DIRECT CHAT -->
              <!DOCTYPE html>
              <html lang="es">

              <head>
                <meta charset="UTF-8">
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <title>Habitantes por Comuna</title>
                <!-- Incluye Chart.js desde CDN -->
                <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
              </head>

              <body>
                <div class="container">
                  <h2>Habitantes por Comuna</h2>
                  <canvas id="graficoComunas" width="400" height="200"></canvas>
                </div>

                <script>
                  // Espera a que el DOM esté completamente cargado
                  document.addEventListener('DOMContentLoaded', function() {
                    // Obtiene el contexto del canvas
                    const ctx = document.getElementById('graficoComunas').getContext('2d');

                    // Define las etiquetas y los datos para el gráfico
                    const labels = ['Comuna 1', 'Comuna 2', 'Comuna 3', 'Comuna 4', 'Comuna 5', 'Comuna 6'];
                    const data = {
                      labels: labels,
                      datasets: [{
                        label: 'Número de Habitantes',
                        data: [
                          @json($contador1),
                          @json($contador2),
                          @json($contador3),
                          @json($contador4),
                          @json($contador5),
                          @json($contador6)
                        ],
                        backgroundColor: 'rgba(54, 162, 235, 0.5)',
                        borderColor: 'rgb(54, 162, 235)',
                        borderWidth: 1
                      }]
                    };

                    // Configura y crea el gráfico
                    const config = {
                      type: 'bar',
                      data: data,
                      options: {
                        responsive: true,
                        scales: {
                          y: {
                            beginAtZero: true,
                            ticks: {
                              stepSize: 1 // Intervalo entre los valores del eje Y
                            }
                          }
                        }
                      }
                    };

                    // Crea una nueva instancia del gráfico
                    new Chart(ctx, config);
                  });
                </script>
              </body>

              </html>
            </div>
          </section>
        </section>
      </div>
    </div>
  </section> <!-- /.content -->
</div>
@endsection